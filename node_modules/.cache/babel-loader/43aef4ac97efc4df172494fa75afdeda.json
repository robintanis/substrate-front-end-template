{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.accounts = accounts;\nexports.account = account;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _bn = _interopRequireDefault(require(\"bn.js\"));\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction groupByEra(list) {\n  return list.reduce((map, {\n    era,\n    value\n  }) => {\n    const key = era.toString();\n    map[key] = (map[key] || _util.BN_ZERO).add(value.unwrap());\n    return map;\n  }, {});\n}\n\nfunction calculateUnlocking(api, stakingLedger, sessionInfo) {\n  const results = Object.entries(groupByEra(((stakingLedger === null || stakingLedger === void 0 ? void 0 : stakingLedger.unlocking) || []).filter(({\n    era\n  }) => era.unwrap().gt(sessionInfo.activeEra)))).map(([eraString, value]) => ({\n    remainingEras: new _bn.default(eraString).isub(sessionInfo.activeEra),\n    value: api.registry.createType('Balance', value)\n  }));\n  return results.length ? results : undefined;\n}\n\nfunction redeemableSum(api, stakingLedger, sessionInfo) {\n  return api.registry.createType('Balance', ((stakingLedger === null || stakingLedger === void 0 ? void 0 : stakingLedger.unlocking) || []).reduce((total, {\n    era,\n    value\n  }) => {\n    return sessionInfo.activeEra.gte(era.unwrap()) ? total.iadd(value.unwrap()) : total;\n  }, new _bn.default(0)));\n}\n\nfunction parseResult(api, sessionInfo, keys, query) {\n  return _objectSpread(_objectSpread(_objectSpread({}, keys), query), {}, {\n    redeemable: redeemableSum(api, query.stakingLedger, sessionInfo),\n    unlocking: calculateUnlocking(api, query.stakingLedger, sessionInfo)\n  });\n}\n/**\n * @description From a list of stashes, fill in all the relevant staking details\n */\n\n\nfunction accounts(instanceId, api) {\n  return (0, _util2.memo)(instanceId, accountIds => api.derive.session.info().pipe((0, _operators.switchMap)(sessionInfo => (0, _rxjs.combineLatest)([api.derive.staking.keysMulti(accountIds), api.derive.staking.queryMulti(accountIds)]).pipe((0, _operators.map)(([keys, queries]) => queries.map((query, index) => parseResult(api, sessionInfo, keys[index], query)))))));\n}\n/**\n * @description From a stash, retrieve the controllerId and fill in all the relevant staking details\n */\n\n\nfunction account(instanceId, api) {\n  return (0, _util2.memo)(instanceId, accountId => api.derive.staking.accounts([accountId]).pipe((0, _operators.map)(([first]) => first)));\n}","map":{"version":3,"sources":["/home/robin/substrate-front-end-template/node_modules/@polkadot/api-derive/staking/account.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","accounts","account","_defineProperty2","_bn","_rxjs","_operators","_util","_util2","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","default","getOwnPropertyDescriptors","defineProperties","groupByEra","list","reduce","map","era","toString","BN_ZERO","add","unwrap","calculateUnlocking","api","stakingLedger","sessionInfo","results","entries","unlocking","gt","activeEra","eraString","remainingEras","isub","registry","createType","undefined","redeemableSum","total","gte","iadd","parseResult","query","redeemable","instanceId","memo","accountIds","derive","session","info","pipe","switchMap","combineLatest","staking","keysMulti","queryMulti","queries","index","accountId","first"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,8CAAD,CAApC;;AAEAC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,QAAR,GAAmBA,QAAnB;AACAF,OAAO,CAACG,OAAR,GAAkBA,OAAlB;;AAEA,IAAIC,gBAAgB,GAAGR,sBAAsB,CAACC,OAAO,CAAC,uCAAD,CAAR,CAA7C;;AAEA,IAAIQ,GAAG,GAAGT,sBAAsB,CAACC,OAAO,CAAC,OAAD,CAAR,CAAhC;;AAEA,IAAIS,KAAK,GAAGT,OAAO,CAAC,MAAD,CAAnB;;AAEA,IAAIU,UAAU,GAAGV,OAAO,CAAC,gBAAD,CAAxB;;AAEA,IAAIW,KAAK,GAAGX,OAAO,CAAC,gBAAD,CAAnB;;AAEA,IAAIY,MAAM,GAAGZ,OAAO,CAAC,SAAD,CAApB;;AAEA,SAASa,OAAT,CAAiBC,MAAjB,EAAyBC,cAAzB,EAAyC;AAAE,MAAIC,IAAI,GAAGf,MAAM,CAACe,IAAP,CAAYF,MAAZ,CAAX;;AAAgC,MAAIb,MAAM,CAACgB,qBAAX,EAAkC;AAAE,QAAIC,OAAO,GAAGjB,MAAM,CAACgB,qBAAP,CAA6BH,MAA7B,CAAd;AAAoD,QAAIC,cAAJ,EAAoBG,OAAO,GAAGA,OAAO,CAACC,MAAR,CAAe,UAAUC,GAAV,EAAe;AAAE,aAAOnB,MAAM,CAACoB,wBAAP,CAAgCP,MAAhC,EAAwCM,GAAxC,EAA6CE,UAApD;AAAiE,KAAjG,CAAV;AAA8GN,IAAAA,IAAI,CAACO,IAAL,CAAUC,KAAV,CAAgBR,IAAhB,EAAsBE,OAAtB;AAAiC;;AAAC,SAAOF,IAAP;AAAc;;AAErV,SAASS,aAAT,CAAuBC,MAAvB,EAA+B;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACC,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AAAE,QAAIG,MAAM,GAAGF,SAAS,CAACD,CAAD,CAAT,IAAgB,IAAhB,GAAuBC,SAAS,CAACD,CAAD,CAAhC,GAAsC,EAAnD;;AAAuD,QAAIA,CAAC,GAAG,CAAR,EAAW;AAAEd,MAAAA,OAAO,CAACZ,MAAM,CAAC6B,MAAD,CAAP,EAAiB,IAAjB,CAAP,CAA8BC,OAA9B,CAAsC,UAAUC,GAAV,EAAe;AAAE,SAAC,GAAGzB,gBAAgB,CAAC0B,OAArB,EAA8BP,MAA9B,EAAsCM,GAAtC,EAA2CF,MAAM,CAACE,GAAD,CAAjD;AAA0D,OAAjH;AAAqH,KAAlI,MAAwI,IAAI/B,MAAM,CAACiC,yBAAX,EAAsC;AAAEjC,MAAAA,MAAM,CAACkC,gBAAP,CAAwBT,MAAxB,EAAgCzB,MAAM,CAACiC,yBAAP,CAAiCJ,MAAjC,CAAhC;AAA4E,KAApH,MAA0H;AAAEjB,MAAAA,OAAO,CAACZ,MAAM,CAAC6B,MAAD,CAAP,CAAP,CAAwBC,OAAxB,CAAgC,UAAUC,GAAV,EAAe;AAAE/B,QAAAA,MAAM,CAACC,cAAP,CAAsBwB,MAAtB,EAA8BM,GAA9B,EAAmC/B,MAAM,CAACoB,wBAAP,CAAgCS,MAAhC,EAAwCE,GAAxC,CAAnC;AAAmF,OAApI;AAAwI;AAAE;;AAAC,SAAON,MAAP;AAAgB;;AAEpiB,SAASU,UAAT,CAAoBC,IAApB,EAA0B;AACxB,SAAOA,IAAI,CAACC,MAAL,CAAY,CAACC,GAAD,EAAM;AACvBC,IAAAA,GADuB;AAEvBpC,IAAAA;AAFuB,GAAN,KAGb;AACJ,UAAM4B,GAAG,GAAGQ,GAAG,CAACC,QAAJ,EAAZ;AACAF,IAAAA,GAAG,CAACP,GAAD,CAAH,GAAW,CAACO,GAAG,CAACP,GAAD,CAAH,IAAYrB,KAAK,CAAC+B,OAAnB,EAA4BC,GAA5B,CAAgCvC,KAAK,CAACwC,MAAN,EAAhC,CAAX;AACA,WAAOL,GAAP;AACD,GAPM,EAOJ,EAPI,CAAP;AAQD;;AAED,SAASM,kBAAT,CAA4BC,GAA5B,EAAiCC,aAAjC,EAAgDC,WAAhD,EAA6D;AAC3D,QAAMC,OAAO,GAAGhD,MAAM,CAACiD,OAAP,CAAed,UAAU,CAAC,CAAC,CAACW,aAAa,KAAK,IAAlB,IAA0BA,aAAa,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,aAAa,CAACI,SAA7E,KAA2F,EAA5F,EAAgGhC,MAAhG,CAAuG,CAAC;AAChJqB,IAAAA;AADgJ,GAAD,KAE3IA,GAAG,CAACI,MAAJ,GAAaQ,EAAb,CAAgBJ,WAAW,CAACK,SAA5B,CAFoC,CAAD,CAAzB,EAEgCd,GAFhC,CAEoC,CAAC,CAACe,SAAD,EAAYlD,KAAZ,CAAD,MAAyB;AAC3EmD,IAAAA,aAAa,EAAE,IAAI/C,GAAG,CAACyB,OAAR,CAAgBqB,SAAhB,EAA2BE,IAA3B,CAAgCR,WAAW,CAACK,SAA5C,CAD4D;AAE3EjD,IAAAA,KAAK,EAAE0C,GAAG,CAACW,QAAJ,CAAaC,UAAb,CAAwB,SAAxB,EAAmCtD,KAAnC;AAFoE,GAAzB,CAFpC,CAAhB;AAMA,SAAO6C,OAAO,CAACpB,MAAR,GAAiBoB,OAAjB,GAA2BU,SAAlC;AACD;;AAED,SAASC,aAAT,CAAuBd,GAAvB,EAA4BC,aAA5B,EAA2CC,WAA3C,EAAwD;AACtD,SAAOF,GAAG,CAACW,QAAJ,CAAaC,UAAb,CAAwB,SAAxB,EAAmC,CAAC,CAACX,aAAa,KAAK,IAAlB,IAA0BA,aAAa,KAAK,KAAK,CAAjD,GAAqD,KAAK,CAA1D,GAA8DA,aAAa,CAACI,SAA7E,KAA2F,EAA5F,EAAgGb,MAAhG,CAAuG,CAACuB,KAAD,EAAQ;AACvJrB,IAAAA,GADuJ;AAEvJpC,IAAAA;AAFuJ,GAAR,KAG3I;AACJ,WAAO4C,WAAW,CAACK,SAAZ,CAAsBS,GAAtB,CAA0BtB,GAAG,CAACI,MAAJ,EAA1B,IAA0CiB,KAAK,CAACE,IAAN,CAAW3D,KAAK,CAACwC,MAAN,EAAX,CAA1C,GAAuEiB,KAA9E;AACD,GALyC,EAKvC,IAAIrD,GAAG,CAACyB,OAAR,CAAgB,CAAhB,CALuC,CAAnC,CAAP;AAMD;;AAED,SAAS+B,WAAT,CAAqBlB,GAArB,EAA0BE,WAA1B,EAAuChC,IAAvC,EAA6CiD,KAA7C,EAAoD;AAClD,SAAOxC,aAAa,CAACA,aAAa,CAACA,aAAa,CAAC,EAAD,EAAKT,IAAL,CAAd,EAA0BiD,KAA1B,CAAd,EAAgD,EAAhD,EAAoD;AACtEC,IAAAA,UAAU,EAAEN,aAAa,CAACd,GAAD,EAAMmB,KAAK,CAAClB,aAAZ,EAA2BC,WAA3B,CAD6C;AAEtEG,IAAAA,SAAS,EAAEN,kBAAkB,CAACC,GAAD,EAAMmB,KAAK,CAAClB,aAAZ,EAA2BC,WAA3B;AAFyC,GAApD,CAApB;AAID;AACD;AACA;AACA;;;AAGA,SAAS3C,QAAT,CAAkB8D,UAAlB,EAA8BrB,GAA9B,EAAmC;AACjC,SAAO,CAAC,GAAGlC,MAAM,CAACwD,IAAX,EAAiBD,UAAjB,EAA6BE,UAAU,IAAIvB,GAAG,CAACwB,MAAJ,CAAWC,OAAX,CAAmBC,IAAnB,GAA0BC,IAA1B,CAA+B,CAAC,GAAG/D,UAAU,CAACgE,SAAf,EAA0B1B,WAAW,IAAI,CAAC,GAAGvC,KAAK,CAACkE,aAAV,EAAyB,CAAC7B,GAAG,CAACwB,MAAJ,CAAWM,OAAX,CAAmBC,SAAnB,CAA6BR,UAA7B,CAAD,EAA2CvB,GAAG,CAACwB,MAAJ,CAAWM,OAAX,CAAmBE,UAAnB,CAA8BT,UAA9B,CAA3C,CAAzB,EAAgHI,IAAhH,CAAqH,CAAC,GAAG/D,UAAU,CAAC6B,GAAf,EAAoB,CAAC,CAACvB,IAAD,EAAO+D,OAAP,CAAD,KAAqBA,OAAO,CAACxC,GAAR,CAAY,CAAC0B,KAAD,EAAQe,KAAR,KAAkBhB,WAAW,CAAClB,GAAD,EAAME,WAAN,EAAmBhC,IAAI,CAACgE,KAAD,CAAvB,EAAgCf,KAAhC,CAAzC,CAAzC,CAArH,CAAzC,CAA/B,CAA3C,CAAP;AACD;AACD;AACA;AACA;;;AAGA,SAAS3D,OAAT,CAAiB6D,UAAjB,EAA6BrB,GAA7B,EAAkC;AAChC,SAAO,CAAC,GAAGlC,MAAM,CAACwD,IAAX,EAAiBD,UAAjB,EAA6Bc,SAAS,IAAInC,GAAG,CAACwB,MAAJ,CAAWM,OAAX,CAAmBvE,QAAnB,CAA4B,CAAC4E,SAAD,CAA5B,EAAyCR,IAAzC,CAA8C,CAAC,GAAG/D,UAAU,CAAC6B,GAAf,EAAoB,CAAC,CAAC2C,KAAD,CAAD,KAAaA,KAAjC,CAA9C,CAA1C,CAAP;AACD","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.accounts = accounts;\nexports.account = account;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _bn = _interopRequireDefault(require(\"bn.js\"));\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction groupByEra(list) {\n  return list.reduce((map, {\n    era,\n    value\n  }) => {\n    const key = era.toString();\n    map[key] = (map[key] || _util.BN_ZERO).add(value.unwrap());\n    return map;\n  }, {});\n}\n\nfunction calculateUnlocking(api, stakingLedger, sessionInfo) {\n  const results = Object.entries(groupByEra(((stakingLedger === null || stakingLedger === void 0 ? void 0 : stakingLedger.unlocking) || []).filter(({\n    era\n  }) => era.unwrap().gt(sessionInfo.activeEra)))).map(([eraString, value]) => ({\n    remainingEras: new _bn.default(eraString).isub(sessionInfo.activeEra),\n    value: api.registry.createType('Balance', value)\n  }));\n  return results.length ? results : undefined;\n}\n\nfunction redeemableSum(api, stakingLedger, sessionInfo) {\n  return api.registry.createType('Balance', ((stakingLedger === null || stakingLedger === void 0 ? void 0 : stakingLedger.unlocking) || []).reduce((total, {\n    era,\n    value\n  }) => {\n    return sessionInfo.activeEra.gte(era.unwrap()) ? total.iadd(value.unwrap()) : total;\n  }, new _bn.default(0)));\n}\n\nfunction parseResult(api, sessionInfo, keys, query) {\n  return _objectSpread(_objectSpread(_objectSpread({}, keys), query), {}, {\n    redeemable: redeemableSum(api, query.stakingLedger, sessionInfo),\n    unlocking: calculateUnlocking(api, query.stakingLedger, sessionInfo)\n  });\n}\n/**\n * @description From a list of stashes, fill in all the relevant staking details\n */\n\n\nfunction accounts(instanceId, api) {\n  return (0, _util2.memo)(instanceId, accountIds => api.derive.session.info().pipe((0, _operators.switchMap)(sessionInfo => (0, _rxjs.combineLatest)([api.derive.staking.keysMulti(accountIds), api.derive.staking.queryMulti(accountIds)]).pipe((0, _operators.map)(([keys, queries]) => queries.map((query, index) => parseResult(api, sessionInfo, keys[index], query)))))));\n}\n/**\n * @description From a stash, retrieve the controllerId and fill in all the relevant staking details\n */\n\n\nfunction account(instanceId, api) {\n  return (0, _util2.memo)(instanceId, accountId => api.derive.staking.accounts([accountId]).pipe((0, _operators.map)(([first]) => first)));\n}"]},"metadata":{},"sourceType":"script"}