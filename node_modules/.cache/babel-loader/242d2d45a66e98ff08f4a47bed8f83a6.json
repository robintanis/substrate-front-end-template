{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compareRationals = compareRationals;\nexports.calcPassing = calcPassing;\nexports.calcVotes = calcVotes;\nexports.getStatus = getStatus;\nexports.parseImage = parseImage;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _bn = _interopRequireDefault(require(\"bn.js\"));\n\nvar _util = require(\"@polkadot/util\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction isOldInfo(info) {\n  return !!info.proposalHash;\n}\n\nfunction isCurrentStatus(status) {\n  return !!status.tally;\n}\n\nfunction isCurrentPreimage(api, imageOpt) {\n  return !!imageOpt && !api.query.democracy.dispatchQueue;\n}\n\nfunction compareRationals(n1, d1, n2, d2) {\n  while (true) {\n    const q1 = n1.div(d1);\n    const q2 = n2.div(d2);\n\n    if (q1.lt(q2)) {\n      return true;\n    } else if (q2.lt(q1)) {\n      return false;\n    }\n\n    const r1 = n1.mod(d1);\n    const r2 = n2.mod(d2);\n\n    if (r2.isZero()) {\n      return false;\n    } else if (r1.isZero()) {\n      return true;\n    }\n\n    n1 = d2;\n    n2 = d1;\n    d1 = r2;\n    d2 = r1;\n  }\n}\n\nfunction calcPassing(threshold, sqrtElectorate, {\n  votedAye,\n  votedNay,\n  votedTotal\n}) {\n  const sqrtVoters = (0, _util.bnSqrt)(votedTotal);\n  return sqrtVoters.isZero() ? false : threshold.isSimplemajority ? votedAye.gt(votedNay) : threshold.isSupermajorityapproval ? compareRationals(votedNay, sqrtVoters, votedAye, sqrtElectorate) : compareRationals(votedNay, sqrtElectorate, votedAye, sqrtVoters);\n}\n\nfunction calcVotesPrev(votesFor) {\n  return votesFor.reduce((state, derived) => {\n    const {\n      balance,\n      vote\n    } = derived;\n    const isDefault = vote.conviction.index === 0;\n    const counted = balance.muln(isDefault ? 1 : vote.conviction.index).divn(isDefault ? 10 : 1);\n\n    if (vote.isAye) {\n      state.allAye.push(derived);\n      state.voteCountAye++;\n      state.votedAye.iadd(counted);\n    } else {\n      state.allNay.push(derived);\n      state.voteCountNay++;\n      state.votedNay.iadd(counted);\n    }\n\n    state.voteCount++;\n    state.votedTotal.iadd(counted);\n    return state;\n  }, {\n    allAye: [],\n    allNay: [],\n    voteCount: 0,\n    voteCountAye: 0,\n    voteCountNay: 0,\n    votedAye: new _bn.default(0),\n    votedNay: new _bn.default(0),\n    votedTotal: new _bn.default(0)\n  });\n}\n\nfunction calcVotesCurrent(tally, votes) {\n  const allAye = [];\n  const allNay = [];\n  votes.forEach(derived => {\n    if (derived.vote.isAye) {\n      allAye.push(derived);\n    } else {\n      allNay.push(derived);\n    }\n  });\n  return {\n    allAye,\n    allNay,\n    voteCount: allAye.length + allNay.length,\n    voteCountAye: allAye.length,\n    voteCountNay: allNay.length,\n    votedAye: tally.ayes,\n    votedNay: tally.nays,\n    votedTotal: tally.turnout\n  };\n}\n\nfunction calcVotes(sqrtElectorate, referendum, votes) {\n  const state = isCurrentStatus(referendum.status) ? calcVotesCurrent(referendum.status.tally, votes) : calcVotesPrev(votes);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    isPassing: calcPassing(referendum.status.threshold, sqrtElectorate, state),\n    votes\n  });\n}\n\nfunction getStatus(info) {\n  if (info.isNone) {\n    return null;\n  }\n\n  const unwrapped = info.unwrap();\n\n  if (isOldInfo(unwrapped)) {\n    return unwrapped;\n  } else if (unwrapped.isOngoing) {\n    return unwrapped.asOngoing;\n  } // done, we don't include it here... only currently active\n\n\n  return null;\n}\n\nfunction constructProposal(api, [bytes, proposer, balance, at]) {\n  let proposal;\n\n  try {\n    proposal = api.registry.createType('Proposal', bytes.toU8a(true));\n  } catch (error) {\n    console.error(error);\n  }\n\n  return {\n    at,\n    balance,\n    proposal,\n    proposer\n  };\n}\n\nfunction parseImage(api, imageOpt) {\n  if (imageOpt.isNone) {\n    return;\n  }\n\n  if (isCurrentPreimage(api, imageOpt)) {\n    const status = imageOpt.unwrap();\n\n    if (status.isMissing) {\n      return;\n    }\n\n    const {\n      data,\n      deposit,\n      provider,\n      since\n    } = status.asAvailable;\n    return constructProposal(api, [data, provider, deposit, since]);\n  }\n\n  return constructProposal(api, imageOpt.unwrap());\n}","map":{"version":3,"sources":["/home/robin/substrate-front-end-template/node_modules/@polkadot/api-derive/democracy/util.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","compareRationals","calcPassing","calcVotes","getStatus","parseImage","_defineProperty2","_bn","_util","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","default","getOwnPropertyDescriptors","defineProperties","isOldInfo","info","proposalHash","isCurrentStatus","status","tally","isCurrentPreimage","api","imageOpt","query","democracy","dispatchQueue","n1","d1","n2","d2","q1","div","q2","lt","r1","mod","r2","isZero","threshold","sqrtElectorate","votedAye","votedNay","votedTotal","sqrtVoters","bnSqrt","isSimplemajority","gt","isSupermajorityapproval","calcVotesPrev","votesFor","reduce","state","derived","balance","vote","isDefault","conviction","index","counted","muln","divn","isAye","allAye","voteCountAye","iadd","allNay","voteCountNay","voteCount","calcVotesCurrent","votes","ayes","nays","turnout","referendum","isPassing","isNone","unwrapped","unwrap","isOngoing","asOngoing","constructProposal","bytes","proposer","at","proposal","registry","createType","toU8a","error","console","isMissing","data","deposit","provider","since","asAvailable"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compareRationals = compareRationals;\nexports.calcPassing = calcPassing;\nexports.calcVotes = calcVotes;\nexports.getStatus = getStatus;\nexports.parseImage = parseImage;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _bn = _interopRequireDefault(require(\"bn.js\"));\n\nvar _util = require(\"@polkadot/util\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction isOldInfo(info) {\n  return !!info.proposalHash;\n}\n\nfunction isCurrentStatus(status) {\n  return !!status.tally;\n}\n\nfunction isCurrentPreimage(api, imageOpt) {\n  return !!imageOpt && !api.query.democracy.dispatchQueue;\n}\n\nfunction compareRationals(n1, d1, n2, d2) {\n  while (true) {\n    const q1 = n1.div(d1);\n    const q2 = n2.div(d2);\n\n    if (q1.lt(q2)) {\n      return true;\n    } else if (q2.lt(q1)) {\n      return false;\n    }\n\n    const r1 = n1.mod(d1);\n    const r2 = n2.mod(d2);\n\n    if (r2.isZero()) {\n      return false;\n    } else if (r1.isZero()) {\n      return true;\n    }\n\n    n1 = d2;\n    n2 = d1;\n    d1 = r2;\n    d2 = r1;\n  }\n}\n\nfunction calcPassing(threshold, sqrtElectorate, {\n  votedAye,\n  votedNay,\n  votedTotal\n}) {\n  const sqrtVoters = (0, _util.bnSqrt)(votedTotal);\n  return sqrtVoters.isZero() ? false : threshold.isSimplemajority ? votedAye.gt(votedNay) : threshold.isSupermajorityapproval ? compareRationals(votedNay, sqrtVoters, votedAye, sqrtElectorate) : compareRationals(votedNay, sqrtElectorate, votedAye, sqrtVoters);\n}\n\nfunction calcVotesPrev(votesFor) {\n  return votesFor.reduce((state, derived) => {\n    const {\n      balance,\n      vote\n    } = derived;\n    const isDefault = vote.conviction.index === 0;\n    const counted = balance.muln(isDefault ? 1 : vote.conviction.index).divn(isDefault ? 10 : 1);\n\n    if (vote.isAye) {\n      state.allAye.push(derived);\n      state.voteCountAye++;\n      state.votedAye.iadd(counted);\n    } else {\n      state.allNay.push(derived);\n      state.voteCountNay++;\n      state.votedNay.iadd(counted);\n    }\n\n    state.voteCount++;\n    state.votedTotal.iadd(counted);\n    return state;\n  }, {\n    allAye: [],\n    allNay: [],\n    voteCount: 0,\n    voteCountAye: 0,\n    voteCountNay: 0,\n    votedAye: new _bn.default(0),\n    votedNay: new _bn.default(0),\n    votedTotal: new _bn.default(0)\n  });\n}\n\nfunction calcVotesCurrent(tally, votes) {\n  const allAye = [];\n  const allNay = [];\n  votes.forEach(derived => {\n    if (derived.vote.isAye) {\n      allAye.push(derived);\n    } else {\n      allNay.push(derived);\n    }\n  });\n  return {\n    allAye,\n    allNay,\n    voteCount: allAye.length + allNay.length,\n    voteCountAye: allAye.length,\n    voteCountNay: allNay.length,\n    votedAye: tally.ayes,\n    votedNay: tally.nays,\n    votedTotal: tally.turnout\n  };\n}\n\nfunction calcVotes(sqrtElectorate, referendum, votes) {\n  const state = isCurrentStatus(referendum.status) ? calcVotesCurrent(referendum.status.tally, votes) : calcVotesPrev(votes);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    isPassing: calcPassing(referendum.status.threshold, sqrtElectorate, state),\n    votes\n  });\n}\n\nfunction getStatus(info) {\n  if (info.isNone) {\n    return null;\n  }\n\n  const unwrapped = info.unwrap();\n\n  if (isOldInfo(unwrapped)) {\n    return unwrapped;\n  } else if (unwrapped.isOngoing) {\n    return unwrapped.asOngoing;\n  } // done, we don't include it here... only currently active\n\n\n  return null;\n}\n\nfunction constructProposal(api, [bytes, proposer, balance, at]) {\n  let proposal;\n\n  try {\n    proposal = api.registry.createType('Proposal', bytes.toU8a(true));\n  } catch (error) {\n    console.error(error);\n  }\n\n  return {\n    at,\n    balance,\n    proposal,\n    proposer\n  };\n}\n\nfunction parseImage(api, imageOpt) {\n  if (imageOpt.isNone) {\n    return;\n  }\n\n  if (isCurrentPreimage(api, imageOpt)) {\n    const status = imageOpt.unwrap();\n\n    if (status.isMissing) {\n      return;\n    }\n\n    const {\n      data,\n      deposit,\n      provider,\n      since\n    } = status.asAvailable;\n    return constructProposal(api, [data, provider, deposit, since]);\n  }\n\n  return constructProposal(api, imageOpt.unwrap());\n}"]},"metadata":{},"sourceType":"script"}