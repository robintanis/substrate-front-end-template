{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.LEDGER_DEFAULT_INDEX = exports.LEDGER_DEFAULT_CHANGE = exports.LEDGER_DEFAULT_ACCOUNT = void 0;\n\nvar _classPrivateFieldLooseBase2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));\n\nvar _classPrivateFieldLooseKey2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));\n\nvar _ledgerPolkadot = require(\"@zondax/ledger-polkadot\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _transportsNode = _interopRequireDefault(require(\"./transportsNode\"));\n\nvar _transportsWeb = _interopRequireDefault(require(\"./transportsWeb\")); // Copyright 2017-2020 @polkadot/ui-keyring authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nconst LEDGER_DEFAULT_ACCOUNT = 0x80000000;\nexports.LEDGER_DEFAULT_ACCOUNT = LEDGER_DEFAULT_ACCOUNT;\nconst LEDGER_DEFAULT_CHANGE = 0x80000000;\nexports.LEDGER_DEFAULT_CHANGE = LEDGER_DEFAULT_CHANGE;\nconst LEDGER_DEFAULT_INDEX = 0x80000000;\nexports.LEDGER_DEFAULT_INDEX = LEDGER_DEFAULT_INDEX;\nconst SUCCESS_CODE = 0x9000;\n\nconst transports = _transportsNode.default.concat(_transportsWeb.default);\n\nconst APPS = {\n  kusama: _ledgerPolkadot.newKusamaApp,\n  polkadot: _ledgerPolkadot.newPolkadotApp\n};\n\nvar _app = (0, _classPrivateFieldLooseKey2.default)(\"app\");\n\nvar _chain = (0, _classPrivateFieldLooseKey2.default)(\"chain\");\n\nvar _transport = (0, _classPrivateFieldLooseKey2.default)(\"transport\"); // A very basic wrapper for a ledger app -\n//  - it connects automatically, creating an app as required\n//  - Promises return errors (instead of wrapper errors)\n\n\nclass Ledger {\n  constructor(transport, chain) {\n    Object.defineProperty(this, _app, {\n      writable: true,\n      value: null\n    });\n    Object.defineProperty(this, _chain, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _transport, {\n      writable: true,\n      value: void 0\n    }); // u2f is deprecated\n\n    (0, _util.assert)(['hid', 'webusb'].includes(transport), `Unsupported transport ${transport}`);\n    (0, _util.assert)(Object.keys(APPS).includes(chain), `Unsupported chain ${chain}`);\n    (0, _classPrivateFieldLooseBase2.default)(this, _chain)[_chain] = chain;\n    (0, _classPrivateFieldLooseBase2.default)(this, _transport)[_transport] = transport;\n  }\n\n  async _getApp() {\n    if (!(0, _classPrivateFieldLooseBase2.default)(this, _app)[_app]) {\n      const def = transports.find(({\n        type\n      }) => type === (0, _classPrivateFieldLooseBase2.default)(this, _transport)[_transport]);\n      (0, _util.assert)(def, `Unable to find a transport for ${(0, _classPrivateFieldLooseBase2.default)(this, _transport)[_transport]}`);\n      const transport = await def.create();\n      (0, _classPrivateFieldLooseBase2.default)(this, _app)[_app] = APPS[(0, _classPrivateFieldLooseBase2.default)(this, _chain)[_chain]](transport);\n    }\n\n    return (0, _classPrivateFieldLooseBase2.default)(this, _app)[_app];\n  }\n\n  async _withApp(fn) {\n    try {\n      const app = await this._getApp();\n      return await fn(app);\n    } catch (error) {\n      (0, _classPrivateFieldLooseBase2.default)(this, _app)[_app] = null;\n      throw error;\n    }\n  }\n\n  async _wrapError(promise) {\n    const result = await promise;\n    (0, _util.assert)(result.return_code === SUCCESS_CODE, result.error_message);\n    return result;\n  }\n\n  async getAddress(confirm = false, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return this._withApp(async app => {\n      const {\n        address,\n        pubKey\n      } = await this._wrapError(app.getAddress(account + accountOffset, change, addressIndex + addressOffset, confirm));\n      return {\n        address,\n        publicKey: `0x${pubKey}`\n      };\n    });\n  }\n\n  async getVersion() {\n    return this._withApp(async app => {\n      const {\n        device_locked: isLocked,\n        major,\n        minor,\n        patch,\n        test_mode: isTestMode\n      } = await this._wrapError(app.getVersion());\n      return {\n        isLocked,\n        isTestMode,\n        version: [major, minor, patch]\n      };\n    });\n  }\n\n  async sign(message, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return this._withApp(async app => {\n      const buffer = (0, _util.u8aToBuffer)(message);\n      const {\n        signature\n      } = await this._wrapError(app.sign(account + accountOffset, change, addressIndex + addressOffset, buffer));\n      return {\n        signature: (0, _util.u8aToHex)((0, _util.bufferToU8a)(signature))\n      };\n    });\n  }\n\n}\n\nexports.default = Ledger;","map":{"version":3,"sources":["/home/robin/substrate-front-end-template/node_modules/@polkadot/ui-keyring/ledger/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","LEDGER_DEFAULT_INDEX","LEDGER_DEFAULT_CHANGE","LEDGER_DEFAULT_ACCOUNT","_classPrivateFieldLooseBase2","_classPrivateFieldLooseKey2","_ledgerPolkadot","_util","_transportsNode","_transportsWeb","SUCCESS_CODE","transports","concat","APPS","kusama","newKusamaApp","polkadot","newPolkadotApp","_app","_chain","_transport","Ledger","constructor","transport","chain","writable","assert","includes","keys","_getApp","def","find","type","create","_withApp","fn","app","error","_wrapError","promise","result","return_code","error_message","getAddress","confirm","accountOffset","addressOffset","account","addressIndex","change","address","pubKey","publicKey","getVersion","device_locked","isLocked","major","minor","patch","test_mode","isTestMode","version","sign","message","buffer","u8aToBuffer","signature","u8aToHex","bufferToU8a"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.LEDGER_DEFAULT_INDEX = exports.LEDGER_DEFAULT_CHANGE = exports.LEDGER_DEFAULT_ACCOUNT = void 0;\n\nvar _classPrivateFieldLooseBase2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseBase\"));\n\nvar _classPrivateFieldLooseKey2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classPrivateFieldLooseKey\"));\n\nvar _ledgerPolkadot = require(\"@zondax/ledger-polkadot\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _transportsNode = _interopRequireDefault(require(\"./transportsNode\"));\n\nvar _transportsWeb = _interopRequireDefault(require(\"./transportsWeb\"));\n\n// Copyright 2017-2020 @polkadot/ui-keyring authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nconst LEDGER_DEFAULT_ACCOUNT = 0x80000000;\nexports.LEDGER_DEFAULT_ACCOUNT = LEDGER_DEFAULT_ACCOUNT;\nconst LEDGER_DEFAULT_CHANGE = 0x80000000;\nexports.LEDGER_DEFAULT_CHANGE = LEDGER_DEFAULT_CHANGE;\nconst LEDGER_DEFAULT_INDEX = 0x80000000;\nexports.LEDGER_DEFAULT_INDEX = LEDGER_DEFAULT_INDEX;\nconst SUCCESS_CODE = 0x9000;\n\nconst transports = _transportsNode.default.concat(_transportsWeb.default);\n\nconst APPS = {\n  kusama: _ledgerPolkadot.newKusamaApp,\n  polkadot: _ledgerPolkadot.newPolkadotApp\n};\n\nvar _app = (0, _classPrivateFieldLooseKey2.default)(\"app\");\n\nvar _chain = (0, _classPrivateFieldLooseKey2.default)(\"chain\");\n\nvar _transport = (0, _classPrivateFieldLooseKey2.default)(\"transport\");\n\n// A very basic wrapper for a ledger app -\n//  - it connects automatically, creating an app as required\n//  - Promises return errors (instead of wrapper errors)\nclass Ledger {\n  constructor(transport, chain) {\n    Object.defineProperty(this, _app, {\n      writable: true,\n      value: null\n    });\n    Object.defineProperty(this, _chain, {\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, _transport, {\n      writable: true,\n      value: void 0\n    });\n    // u2f is deprecated\n    (0, _util.assert)(['hid', 'webusb'].includes(transport), `Unsupported transport ${transport}`);\n    (0, _util.assert)(Object.keys(APPS).includes(chain), `Unsupported chain ${chain}`);\n    (0, _classPrivateFieldLooseBase2.default)(this, _chain)[_chain] = chain;\n    (0, _classPrivateFieldLooseBase2.default)(this, _transport)[_transport] = transport;\n  }\n\n  async _getApp() {\n    if (!(0, _classPrivateFieldLooseBase2.default)(this, _app)[_app]) {\n      const def = transports.find(({\n        type\n      }) => type === (0, _classPrivateFieldLooseBase2.default)(this, _transport)[_transport]);\n      (0, _util.assert)(def, `Unable to find a transport for ${(0, _classPrivateFieldLooseBase2.default)(this, _transport)[_transport]}`);\n      const transport = await def.create();\n      (0, _classPrivateFieldLooseBase2.default)(this, _app)[_app] = APPS[(0, _classPrivateFieldLooseBase2.default)(this, _chain)[_chain]](transport);\n    }\n\n    return (0, _classPrivateFieldLooseBase2.default)(this, _app)[_app];\n  }\n\n  async _withApp(fn) {\n    try {\n      const app = await this._getApp();\n      return await fn(app);\n    } catch (error) {\n      (0, _classPrivateFieldLooseBase2.default)(this, _app)[_app] = null;\n      throw error;\n    }\n  }\n\n  async _wrapError(promise) {\n    const result = await promise;\n    (0, _util.assert)(result.return_code === SUCCESS_CODE, result.error_message);\n    return result;\n  }\n\n  async getAddress(confirm = false, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return this._withApp(async app => {\n      const {\n        address,\n        pubKey\n      } = await this._wrapError(app.getAddress(account + accountOffset, change, addressIndex + addressOffset, confirm));\n      return {\n        address,\n        publicKey: `0x${pubKey}`\n      };\n    });\n  }\n\n  async getVersion() {\n    return this._withApp(async app => {\n      const {\n        device_locked: isLocked,\n        major,\n        minor,\n        patch,\n        test_mode: isTestMode\n      } = await this._wrapError(app.getVersion());\n      return {\n        isLocked,\n        isTestMode,\n        version: [major, minor, patch]\n      };\n    });\n  }\n\n  async sign(message, accountOffset = 0, addressOffset = 0, {\n    account = LEDGER_DEFAULT_ACCOUNT,\n    addressIndex = LEDGER_DEFAULT_INDEX,\n    change = LEDGER_DEFAULT_CHANGE\n  } = {}) {\n    return this._withApp(async app => {\n      const buffer = (0, _util.u8aToBuffer)(message);\n      const {\n        signature\n      } = await this._wrapError(app.sign(account + accountOffset, change, addressIndex + addressOffset, buffer));\n      return {\n        signature: (0, _util.u8aToHex)((0, _util.bufferToU8a)(signature))\n      };\n    });\n  }\n\n}\n\nexports.default = Ledger;"]},"metadata":{},"sourceType":"script"}