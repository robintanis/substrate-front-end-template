{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.all = all;\n\nvar _bn = _interopRequireDefault(require(\"bn.js\"));\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\"); // Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nconst VESTING_ID = '0x76657374696e6720';\n\nfunction calcBalances(api, [{\n  accountId,\n  accountNonce,\n  freeBalance,\n  frozenFee,\n  frozenMisc,\n  reservedBalance,\n  votingBalance\n}, bestNumber, [vesting, locks]]) {\n  let lockedBalance = api.registry.createType('Balance');\n  let lockedBreakdown = [];\n  let vestingLocked = api.registry.createType('Balance');\n  let allLocked = false;\n\n  if (Array.isArray(locks)) {\n    // only get the locks that are valid until passed the current block\n    lockedBreakdown = locks.filter(({\n      until\n    }) => !until || bestNumber && until.gt(bestNumber));\n    const notAll = lockedBreakdown.filter(({\n      amount\n    }) => !amount.isMax());\n    allLocked = lockedBreakdown.some(({\n      amount\n    }) => amount.isMax());\n    vestingLocked = api.registry.createType('Balance', lockedBreakdown.filter(({\n      id\n    }) => id.eq(VESTING_ID)).reduce((result, {\n      amount\n    }) => result.iadd(amount), new _bn.default(0))); // get the maximum of the locks according to https://github.com/paritytech/substrate/blob/master/srml/balances/src/lib.rs#L699\n\n    if (notAll.length) {\n      lockedBalance = api.registry.createType('Balance', (0, _util.bnMax)(...notAll.map(({\n        amount\n      }) => amount)));\n    }\n  } // Calculate the vesting balances,\n  //  - offset = balance locked at startingBlock\n  //  - perBlock is the unlock amount\n\n\n  const {\n    locked: vestingTotal,\n    perBlock,\n    startingBlock\n  } = vesting || api.registry.createType('VestingInfo');\n  const isStarted = bestNumber.gt(startingBlock);\n  const vestedNow = isStarted ? perBlock.mul(bestNumber.sub(startingBlock)) : new _bn.default(0);\n  const vestedBalance = vestedNow.gt(vestingTotal) ? vestingTotal : api.registry.createType('Balance', vestedNow);\n  const isVesting = isStarted && !vestingLocked.isZero();\n  const vestedClaimable = api.registry.createType('Balance', isVesting ? vestingLocked.sub(vestingTotal.sub(vestedBalance)) : 0);\n  const availableBalance = api.registry.createType('Balance', allLocked ? 0 : (0, _util.bnMax)(new _bn.default(0), freeBalance.sub(lockedBalance)));\n  const vestingEndBlock = api.registry.createType('BlockNumber', isVesting ? vestingTotal.div(perBlock).add(startingBlock) : 0);\n  return {\n    accountId,\n    accountNonce,\n    availableBalance,\n    freeBalance,\n    frozenFee,\n    frozenMisc,\n    isVesting,\n    lockedBalance,\n    lockedBreakdown,\n    reservedBalance,\n    vestedBalance,\n    vestedClaimable,\n    vestingEndBlock,\n    vestingLocked,\n    vestingPerBlock: perBlock,\n    vestingTotal,\n    votingBalance\n  };\n} // old\n\n\nfunction queryOld(api, accountId) {\n  return api.queryMulti([[api.query.balances.locks, accountId], [api.query.balances.vesting, accountId]]).pipe((0, _operators.map)(([locks, optVesting]) => {\n    let vestingNew = null;\n\n    if (optVesting.isSome) {\n      const {\n        offset: locked,\n        perBlock,\n        startingBlock\n      } = optVesting.unwrap();\n      vestingNew = api.registry.createType('VestingInfo', {\n        locked,\n        perBlock,\n        startingBlock\n      });\n    }\n\n    return [vestingNew, locks];\n  }));\n} // current (balances  vesting)\n\n\nfunction queryCurrent(api, accountId) {\n  var _api$query$vesting;\n\n  return (((_api$query$vesting = api.query.vesting) === null || _api$query$vesting === void 0 ? void 0 : _api$query$vesting.vesting) ? api.queryMulti([[api.query.balances.locks, accountId], [api.query.vesting.vesting, accountId]]) : api.query.balances.locks(accountId).pipe((0, _operators.map)(locks => [locks, api.registry.createType('Option<VestingInfo>')]))).pipe((0, _operators.map)(([locks, optVesting]) => [optVesting.unwrapOr(null), locks]));\n}\n/**\n * @name all\n * @param {( AccountIndex | AccountId | Address | string )} address - An accounts Id in different formats.\n * @returns An object containing the results of various balance queries\n * @example\n * <BR>\n *\n * ```javascript\n * const ALICE = 'F7Hs';\n *\n * api.derive.balances.all(ALICE, ({ accountId, lockedBalance }) => {\n *   console.log(`The account ${accountId} has a locked balance ${lockedBalance} units.`);\n * });\n * ```\n */\n\n\nfunction all(instanceId, api) {\n  return (0, _util2.memo)(instanceId, address => api.derive.balances.account(address).pipe((0, _operators.switchMap)(account => !account.accountId.isEmpty ? (0, _rxjs.combineLatest)([(0, _rxjs.of)(account), api.derive.chain.bestNumber(), (0, _util.isFunction)(api.query.system.account) || (0, _util.isFunction)(api.query.balances.account) ? queryCurrent(api, account.accountId) : queryOld(api, account.accountId)]) : (0, _rxjs.of)([account, api.registry.createType('BlockNumber'), [null, api.registry.createType('Vec<BalanceLock>')]])), (0, _operators.map)(result => calcBalances(api, result))));\n}","map":{"version":3,"sources":["/home/robin/substrate-front-end-template/node_modules/@polkadot/api-derive/balances/all.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","all","_bn","_rxjs","_operators","_util","_util2","VESTING_ID","calcBalances","api","accountId","accountNonce","freeBalance","frozenFee","frozenMisc","reservedBalance","votingBalance","bestNumber","vesting","locks","lockedBalance","registry","createType","lockedBreakdown","vestingLocked","allLocked","Array","isArray","filter","until","gt","notAll","amount","isMax","some","id","eq","reduce","result","iadd","default","length","bnMax","map","locked","vestingTotal","perBlock","startingBlock","isStarted","vestedNow","mul","sub","vestedBalance","isVesting","isZero","vestedClaimable","availableBalance","vestingEndBlock","div","add","vestingPerBlock","queryOld","queryMulti","query","balances","pipe","optVesting","vestingNew","isSome","offset","unwrap","queryCurrent","_api$query$vesting","unwrapOr","instanceId","memo","address","derive","account","switchMap","isEmpty","combineLatest","of","chain","isFunction","system"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.all = all;\n\nvar _bn = _interopRequireDefault(require(\"bn.js\"));\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\");\n\n// Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nconst VESTING_ID = '0x76657374696e6720';\n\nfunction calcBalances(api, [{\n  accountId,\n  accountNonce,\n  freeBalance,\n  frozenFee,\n  frozenMisc,\n  reservedBalance,\n  votingBalance\n}, bestNumber, [vesting, locks]]) {\n  let lockedBalance = api.registry.createType('Balance');\n  let lockedBreakdown = [];\n  let vestingLocked = api.registry.createType('Balance');\n  let allLocked = false;\n\n  if (Array.isArray(locks)) {\n    // only get the locks that are valid until passed the current block\n    lockedBreakdown = locks.filter(({\n      until\n    }) => !until || bestNumber && until.gt(bestNumber));\n    const notAll = lockedBreakdown.filter(({\n      amount\n    }) => !amount.isMax());\n    allLocked = lockedBreakdown.some(({\n      amount\n    }) => amount.isMax());\n    vestingLocked = api.registry.createType('Balance', lockedBreakdown.filter(({\n      id\n    }) => id.eq(VESTING_ID)).reduce((result, {\n      amount\n    }) => result.iadd(amount), new _bn.default(0))); // get the maximum of the locks according to https://github.com/paritytech/substrate/blob/master/srml/balances/src/lib.rs#L699\n\n    if (notAll.length) {\n      lockedBalance = api.registry.createType('Balance', (0, _util.bnMax)(...notAll.map(({\n        amount\n      }) => amount)));\n    }\n  } // Calculate the vesting balances,\n  //  - offset = balance locked at startingBlock\n  //  - perBlock is the unlock amount\n\n\n  const {\n    locked: vestingTotal,\n    perBlock,\n    startingBlock\n  } = vesting || api.registry.createType('VestingInfo');\n  const isStarted = bestNumber.gt(startingBlock);\n  const vestedNow = isStarted ? perBlock.mul(bestNumber.sub(startingBlock)) : new _bn.default(0);\n  const vestedBalance = vestedNow.gt(vestingTotal) ? vestingTotal : api.registry.createType('Balance', vestedNow);\n  const isVesting = isStarted && !vestingLocked.isZero();\n  const vestedClaimable = api.registry.createType('Balance', isVesting ? vestingLocked.sub(vestingTotal.sub(vestedBalance)) : 0);\n  const availableBalance = api.registry.createType('Balance', allLocked ? 0 : (0, _util.bnMax)(new _bn.default(0), freeBalance.sub(lockedBalance)));\n  const vestingEndBlock = api.registry.createType('BlockNumber', isVesting ? vestingTotal.div(perBlock).add(startingBlock) : 0);\n  return {\n    accountId,\n    accountNonce,\n    availableBalance,\n    freeBalance,\n    frozenFee,\n    frozenMisc,\n    isVesting,\n    lockedBalance,\n    lockedBreakdown,\n    reservedBalance,\n    vestedBalance,\n    vestedClaimable,\n    vestingEndBlock,\n    vestingLocked,\n    vestingPerBlock: perBlock,\n    vestingTotal,\n    votingBalance\n  };\n} // old\n\n\nfunction queryOld(api, accountId) {\n  return api.queryMulti([[api.query.balances.locks, accountId], [api.query.balances.vesting, accountId]]).pipe((0, _operators.map)(([locks, optVesting]) => {\n    let vestingNew = null;\n\n    if (optVesting.isSome) {\n      const {\n        offset: locked,\n        perBlock,\n        startingBlock\n      } = optVesting.unwrap();\n      vestingNew = api.registry.createType('VestingInfo', {\n        locked,\n        perBlock,\n        startingBlock\n      });\n    }\n\n    return [vestingNew, locks];\n  }));\n} // current (balances  vesting)\n\n\nfunction queryCurrent(api, accountId) {\n  var _api$query$vesting;\n\n  return (((_api$query$vesting = api.query.vesting) === null || _api$query$vesting === void 0 ? void 0 : _api$query$vesting.vesting) ? api.queryMulti([[api.query.balances.locks, accountId], [api.query.vesting.vesting, accountId]]) : api.query.balances.locks(accountId).pipe((0, _operators.map)(locks => [locks, api.registry.createType('Option<VestingInfo>')]))).pipe((0, _operators.map)(([locks, optVesting]) => [optVesting.unwrapOr(null), locks]));\n}\n/**\n * @name all\n * @param {( AccountIndex | AccountId | Address | string )} address - An accounts Id in different formats.\n * @returns An object containing the results of various balance queries\n * @example\n * <BR>\n *\n * ```javascript\n * const ALICE = 'F7Hs';\n *\n * api.derive.balances.all(ALICE, ({ accountId, lockedBalance }) => {\n *   console.log(`The account ${accountId} has a locked balance ${lockedBalance} units.`);\n * });\n * ```\n */\n\n\nfunction all(instanceId, api) {\n  return (0, _util2.memo)(instanceId, address => api.derive.balances.account(address).pipe((0, _operators.switchMap)(account => !account.accountId.isEmpty ? (0, _rxjs.combineLatest)([(0, _rxjs.of)(account), api.derive.chain.bestNumber(), (0, _util.isFunction)(api.query.system.account) || (0, _util.isFunction)(api.query.balances.account) ? queryCurrent(api, account.accountId) : queryOld(api, account.accountId)]) : (0, _rxjs.of)([account, api.registry.createType('BlockNumber'), [null, api.registry.createType('Vec<BalanceLock>')]])), (0, _operators.map)(result => calcBalances(api, result))));\n}"]},"metadata":{},"sourceType":"script"}