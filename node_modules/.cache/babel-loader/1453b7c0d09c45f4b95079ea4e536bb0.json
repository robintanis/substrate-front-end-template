{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._eraExposure = _eraExposure;\nexports.eraExposure = eraExposure;\nexports._erasExposure = _erasExposure;\nexports.erasExposure = erasExposure;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"../util\"); // Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nconst CACHE_KEY = 'eraExposure';\n\nfunction mapStakers(era, stakers) {\n  const nominators = {};\n  const validators = {};\n  stakers.forEach(([key, exposure]) => {\n    const validatorId = key.args[1].toString();\n    validators[validatorId] = exposure;\n    exposure.others.forEach(({\n      who\n    }, validatorIndex) => {\n      const nominatorId = who.toString();\n      nominators[nominatorId] = nominators[nominatorId] || [];\n      nominators[nominatorId].push({\n        validatorId,\n        validatorIndex\n      });\n    });\n  });\n  return {\n    era,\n    nominators,\n    validators\n  };\n}\n\nfunction _eraExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, (era, withActive) => {\n    const cacheKey = `${CACHE_KEY}-${era.toString()}`;\n    const cached = withActive ? undefined : _util.deriveCache.get(cacheKey);\n    return cached ? (0, _rxjs.of)(cached) : api.query.staking.erasStakersClipped.entries(era).pipe((0, _operators.map)(stakers => {\n      const value = mapStakers(era, stakers);\n      !withActive && _util.deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\n\nfunction eraExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, era => api.derive.staking._eraExposure(era, true));\n}\n\nfunction _erasExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, (eras, withActive) => eras.length ? (0, _rxjs.combineLatest)(eras.map(era => api.derive.staking._eraExposure(era, withActive))) : (0, _rxjs.of)([]));\n}\n\nfunction erasExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe((0, _operators.switchMap)(eras => api.derive.staking._erasExposure(eras, withActive))));\n}","map":{"version":3,"sources":["/home/robin/substrate-front-end-template/node_modules/@polkadot/api-derive/staking/erasExposure.js"],"names":["Object","defineProperty","exports","value","_eraExposure","eraExposure","_erasExposure","erasExposure","_rxjs","require","_operators","_util","CACHE_KEY","mapStakers","era","stakers","nominators","validators","forEach","key","exposure","validatorId","args","toString","others","who","validatorIndex","nominatorId","push","instanceId","api","memo","withActive","cacheKey","cached","undefined","deriveCache","get","of","query","staking","erasStakersClipped","entries","pipe","map","set","derive","eras","length","combineLatest","erasHistoric","switchMap"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._eraExposure = _eraExposure;\nexports.eraExposure = eraExposure;\nexports._erasExposure = _erasExposure;\nexports.erasExposure = erasExposure;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"../util\");\n\n// Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nconst CACHE_KEY = 'eraExposure';\n\nfunction mapStakers(era, stakers) {\n  const nominators = {};\n  const validators = {};\n  stakers.forEach(([key, exposure]) => {\n    const validatorId = key.args[1].toString();\n    validators[validatorId] = exposure;\n    exposure.others.forEach(({\n      who\n    }, validatorIndex) => {\n      const nominatorId = who.toString();\n      nominators[nominatorId] = nominators[nominatorId] || [];\n      nominators[nominatorId].push({\n        validatorId,\n        validatorIndex\n      });\n    });\n  });\n  return {\n    era,\n    nominators,\n    validators\n  };\n}\n\nfunction _eraExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, (era, withActive) => {\n    const cacheKey = `${CACHE_KEY}-${era.toString()}`;\n    const cached = withActive ? undefined : _util.deriveCache.get(cacheKey);\n    return cached ? (0, _rxjs.of)(cached) : api.query.staking.erasStakersClipped.entries(era).pipe((0, _operators.map)(stakers => {\n      const value = mapStakers(era, stakers);\n      !withActive && _util.deriveCache.set(cacheKey, value);\n      return value;\n    }));\n  });\n}\n\nfunction eraExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, era => api.derive.staking._eraExposure(era, true));\n}\n\nfunction _erasExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, (eras, withActive) => eras.length ? (0, _rxjs.combineLatest)(eras.map(era => api.derive.staking._eraExposure(era, withActive))) : (0, _rxjs.of)([]));\n}\n\nfunction erasExposure(instanceId, api) {\n  return (0, _util.memo)(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe((0, _operators.switchMap)(eras => api.derive.staking._erasExposure(eras, withActive))));\n}"]},"metadata":{},"sourceType":"script"}