{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signingInfo = signingInfo;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _constants = require(\"./constants\"); // Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nfunction latestNonce(api, address) {\n  return api.derive.balances.account(address).pipe((0, _operators.map)(({\n    accountNonce\n  }) => accountNonce));\n}\n\nfunction nextNonce(api, address) {\n  var _api$rpc$system;\n\n  return ((_api$rpc$system = api.rpc.system) === null || _api$rpc$system === void 0 ? void 0 : _api$rpc$system.accountNextIndex) ? api.rpc.system.accountNextIndex(address) : latestNonce(api, address);\n}\n\nfunction signingHeader(api) {\n  return (0, _rxjs.combineLatest)([api.rpc.chain.getHeader(), api.rpc.chain.getFinalizedHead().pipe((0, _operators.switchMap)(hash => api.rpc.chain.getHeader(hash)))]).pipe((0, _operators.map)(([current, finalized]) => // determine the hash to use, current when lag > max, else finalized\n  current.number.unwrap().sub(finalized.number.unwrap()).gt(_constants.MAX_FINALITY_LAG) ? current : finalized));\n}\n\nfunction signingInfo(_instanceId, api) {\n  // no memo, we want to do this fresh on each run\n  return (address, nonce, era) => (0, _rxjs.combineLatest)([// retrieve nonce if none was specified\n  (0, _util.isUndefined)(nonce) ? latestNonce(api, address) : nonce === -1 ? nextNonce(api, address) : (0, _rxjs.of)(api.registry.createType('Index', nonce)), // if no era (create) or era > 0 (mortal), do block retrieval\n  (0, _util.isUndefined)(era) || (0, _util.isNumber)(era) && era > 0 ? signingHeader(api) : (0, _rxjs.of)(null)]).pipe((0, _operators.map)(([nonce, header]) => {\n    var _api$consts$babe, _api$consts$timestamp;\n\n    return {\n      header,\n      mortalLength: _constants.MORTAL_PERIOD.div(((_api$consts$babe = api.consts.babe) === null || _api$consts$babe === void 0 ? void 0 : _api$consts$babe.expectedBlockTime) || ((_api$consts$timestamp = api.consts.timestamp) === null || _api$consts$timestamp === void 0 ? void 0 : _api$consts$timestamp.minimumPeriod.muln(2)) || _constants.FALLBACK_PERIOD).iadd(_constants.MAX_FINALITY_LAG).toNumber(),\n      nonce\n    };\n  }));\n}","map":{"version":3,"sources":["/home/robin/substrate-front-end-template/node_modules/@polkadot/api-derive/tx/signingInfo.js"],"names":["Object","defineProperty","exports","value","signingInfo","_rxjs","require","_operators","_util","_constants","latestNonce","api","address","derive","balances","account","pipe","map","accountNonce","nextNonce","_api$rpc$system","rpc","system","accountNextIndex","signingHeader","combineLatest","chain","getHeader","getFinalizedHead","switchMap","hash","current","finalized","number","unwrap","sub","gt","MAX_FINALITY_LAG","_instanceId","nonce","era","isUndefined","of","registry","createType","isNumber","header","_api$consts$babe","_api$consts$timestamp","mortalLength","MORTAL_PERIOD","div","consts","babe","expectedBlockTime","timestamp","minimumPeriod","muln","FALLBACK_PERIOD","iadd","toNumber"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signingInfo = signingInfo;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _constants = require(\"./constants\");\n\n// Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nfunction latestNonce(api, address) {\n  return api.derive.balances.account(address).pipe((0, _operators.map)(({\n    accountNonce\n  }) => accountNonce));\n}\n\nfunction nextNonce(api, address) {\n  var _api$rpc$system;\n\n  return ((_api$rpc$system = api.rpc.system) === null || _api$rpc$system === void 0 ? void 0 : _api$rpc$system.accountNextIndex) ? api.rpc.system.accountNextIndex(address) : latestNonce(api, address);\n}\n\nfunction signingHeader(api) {\n  return (0, _rxjs.combineLatest)([api.rpc.chain.getHeader(), api.rpc.chain.getFinalizedHead().pipe((0, _operators.switchMap)(hash => api.rpc.chain.getHeader(hash)))]).pipe((0, _operators.map)(([current, finalized]) => // determine the hash to use, current when lag > max, else finalized\n  current.number.unwrap().sub(finalized.number.unwrap()).gt(_constants.MAX_FINALITY_LAG) ? current : finalized));\n}\n\nfunction signingInfo(_instanceId, api) {\n  // no memo, we want to do this fresh on each run\n  return (address, nonce, era) => (0, _rxjs.combineLatest)([// retrieve nonce if none was specified\n  (0, _util.isUndefined)(nonce) ? latestNonce(api, address) : nonce === -1 ? nextNonce(api, address) : (0, _rxjs.of)(api.registry.createType('Index', nonce)), // if no era (create) or era > 0 (mortal), do block retrieval\n  (0, _util.isUndefined)(era) || (0, _util.isNumber)(era) && era > 0 ? signingHeader(api) : (0, _rxjs.of)(null)]).pipe((0, _operators.map)(([nonce, header]) => {\n    var _api$consts$babe, _api$consts$timestamp;\n\n    return {\n      header,\n      mortalLength: _constants.MORTAL_PERIOD.div(((_api$consts$babe = api.consts.babe) === null || _api$consts$babe === void 0 ? void 0 : _api$consts$babe.expectedBlockTime) || ((_api$consts$timestamp = api.consts.timestamp) === null || _api$consts$timestamp === void 0 ? void 0 : _api$consts$timestamp.minimumPeriod.muln(2)) || _constants.FALLBACK_PERIOD).iadd(_constants.MAX_FINALITY_LAG).toNumber(),\n      nonce\n    };\n  }));\n}"]},"metadata":{},"sourceType":"script"}